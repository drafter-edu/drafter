

<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>JavaScript in Drafter &#8212; Drafter 1.9.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css?v=f9ae72be" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=090ae2a6" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=38ba398c"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="More Help" href="../students/help.html" />
    <link rel="prev" title="Deployed Site Compatibility" href="compatibility.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../students/help.html" title="More Help"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="compatibility.html" title="Deployed Site Compatibility"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../contents.html">Drafter 1.9.4 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="reference.html" accesskey="U">Reference Lists</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">JavaScript in Drafter</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="javascript-in-drafter">
<span id="js"></span><h1>JavaScript in Drafter<a class="headerlink" href="#javascript-in-drafter" title="Link to this heading">¶</a></h1>
<p>Drafter allows you to include JavaScript code within your Drafter applications, although this is not
the preferred way to build Drafter sites. There are also some limitations when it comes to deploying
Drafter sites with JavaScript.</p>
<p>In local development, you can actually just include JavaScript code by embedding <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> tags
within the HTML strings that you return from your Drafter routes. Unfortunately, when you deploy this,
you will find that it does not work. This is because of how Drafter works when deployed via GitHub Actions;
the JavaScript code is rendered just as text.</p>
<p>To properly include JavaScript in your deployed Drafter site, you have to take advantage of the <cite>js</cite> keyword
of the <cite>Page</cite> class. You can provide either a string or a list of strings that contain JavaScript code, and Drafter
will include this code in the rendered HTML of your site and execute it correctly. In the example below,
we use the f-string feature to embed a Python variable’s value in the JavaScript alert:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">drafter</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="nd">@route</span>
<span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Page</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Page</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">[</span>
            <span class="n">Text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello world! Message is </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">js</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            alert(&quot;This is an alert from JavaScript! Message is: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;);</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

<span class="n">start_server</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="errors">
<h2>Errors<a class="headerlink" href="#errors" title="Link to this heading">¶</a></h2>
<p>One other major limitation of using JavaScript is that the code will be executed in the global scope, which
has some implications. In particular, you cannot define functions or variables that are scoped to a particular route or page;
everything will be global. This means that you have to be careful about naming conflicts and variable/function
collisions.</p>
<p>Observe the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">drafter</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="nd">@route</span>
<span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Page</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Page</span><span class="p">([</span>
        <span class="n">Text</span><span class="p">(</span><span class="s2">&quot;This page works fine.&quot;</span><span class="p">),</span>
        <span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Next&quot;</span><span class="p">,</span> <span class="s2">&quot;another_page&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">js</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        let counter = 0;</span>
<span class="s2">        alert(&quot;Counter is &quot; + counter);</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="nd">@route</span>
<span class="k">def</span><span class="w"> </span><span class="nf">another_page</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Page</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Page</span><span class="p">([</span>
        <span class="n">Text</span><span class="p">(</span><span class="s2">&quot;This page will have an error in the JS console.&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">js</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        let counter = 2;</span>
<span class="s2">        alert(&quot;Counter is &quot; + counter);</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">start_server</span><span class="p">()</span>
</pre></div>
</div>
<p>In this example, the JavaScript code in both routes defines a variable named <code class="docutils literal notranslate"><span class="pre">counter</span></code>.
When you navigate to the <code class="docutils literal notranslate"><span class="pre">another_page</span></code>, you will see an error in the JavaScript console indicating that
the variable <code class="docutils literal notranslate"><span class="pre">counter</span></code> has already been declared. This is because both pieces of JavaScript code
are executed in the global scope, leading to a naming conflict.
You can find these kinds of errors by opening the browser’s developer tools and checking the console for error messages.</p>
<blockquote>
<div><ul class="simple">
<li><p>In Chrome, you can open the developer tools by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+Shift+I</span></code> (or <code class="docutils literal notranslate"><span class="pre">Cmd+Option+I</span></code> on Mac) and navigating to the “Console” tab.</p></li>
<li><p>In Firefox, you can open the developer tools by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+Shift+K</span></code> (or <code class="docutils literal notranslate"><span class="pre">Cmd+Option+K</span></code> on Mac).</p></li>
<li><p>In Edge, you can open the developer tools by pressing <code class="docutils literal notranslate"><span class="pre">F12</span></code> and navigating to the “Console” tab.</p></li>
</ul>
</div></blockquote>
<img alt="JavaScript Error in Console" class="align-center" src="../_images/js_console_error.png" />
<p>The simplest solution is to always wrap your JavaScript code in an immediately-invoked function expression (IIFE),
which creates a new scope for your code. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@route</span>
<span class="k">def</span><span class="w"> </span><span class="nf">another_page</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Page</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Page</span><span class="p">([</span>
        <span class="n">Text</span><span class="p">(</span><span class="s2">&quot;This page will have an error in the JS console.&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">js</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (function() {</span>
<span class="s2">        let counter = 2;</span>
<span class="s2">        alert(&quot;Counter is &quot; + counter);</span>
<span class="s2">    })();</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course, if you are using an f-string to embed Python variables, you will need to adjust accordingly.
Specifically, you are going to need to have double curly braces around the JavaScript code. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">js</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">(function() </span><span class="se">{{</span>
<span class="s2">    let counter = </span><span class="si">{</span><span class="n">some_python_variable</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">    alert(&quot;Counter is &quot; + counter);</span>
<span class="se">}}</span><span class="s2">)();</span>
</pre></div>
</div>
<p>We strongly recommend using the <code class="docutils literal notranslate"><span class="pre">Try</span> <span class="pre">Deployment</span></code> button at the bottom of the Drafter debug panel, to
test your site in the deployed environment without having to push to GitHub every time.</p>
<img alt="Try Deployment Button" class="align-center" src="../_images/js_try_deployment.png" />
</section>
<section id="deployment-vs-local-development">
<h2>Deployment vs Local Development<a class="headerlink" href="#deployment-vs-local-development" title="Link to this heading">¶</a></h2>
<p>One other important caveat about using JavaScript in Drafter is that the page does reload every time
you navigate to a new route, but only in the local version. In the deployed version, Drafter loads
new pages without reloading the entire page. This means that any JavaScript
that relies on the page loading (e.g., <code class="docutils literal notranslate"><span class="pre">window.onload</span></code> events) will not work as expected in the
deployed version. Conversely, any JavaScript that was previously running locally will be terminated
when navigating to a new route in the local version.</p>
<p>We know this is confusing. We are working to improve it in Drafter V2. For now, just be aware of this
difference when developing with JavaScript in Drafter.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../contents.html">Page contents</a></h3>
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../students/installation.html">How to Install Drafter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/quickstart.html">Drafter Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workbook/index.html">Workbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples.html">Longer Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../students/docs.html">Drafter Documentation for Students</a></li>
<li class="toctree-l1"><a class="reference internal" href="../students/html.html">HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../students/styling.html">Styling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../students/testing.html">Testing Drafter Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../students/deployment.html">Deployment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="reference.html">Reference Lists</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="colors.html">HTML Colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="components.html">Components Cheatsheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="fonts.html">HTML Fonts</a></li>
<li class="toctree-l2"><a class="reference internal" href="flask.html">Transitioning from Drafter to Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="local_setup.html">Local Python Development Setup Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="llms.html">Gemini Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="pillow.html">Pillow Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="compatibility.html">Deployed Site Compatibility</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">JavaScript in Drafter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#errors">Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployment-vs-local-development">Deployment vs Local Development</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../students/help.html">More Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">Full API Documentation</a></li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="compatibility.html"
                          title="Previous page">&larr; Deployed Site Compatibility</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="../students/help.html"
                          title="Next page">&rarr; More Help</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/js.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../students/help.html" title="More Help"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="compatibility.html" title="Deployed Site Compatibility"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../contents.html">Drafter 1.9.4 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="reference.html" >Reference Lists</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">JavaScript in Drafter</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, acbart &amp; nazim.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>